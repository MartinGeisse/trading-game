<html>
<head>
    <style type="text/css">

        #map-container {
            position: fixed;
            top: 0px;
            bottom: 0px;
            left: 0px;
            right: 0px;
            background-color: black;
        }

    </style>
    <script type="text/javascript" src="jquery-3.2.1.js"></script>
    <script type="text/javascript" src="jquery.mousewheel.js"></script>
    <script type="text/javascript" src="d3.js"></script>
    <script type="text/javascript">

        var mapView = {
            zoom: 1,
            mapOriginX: 0, // the position of the map's origin on the page (NOT the other way round!)
            mapOriginY: 0
        };

        function applyZoom() {
            $('#map-zooming-group').attr('transform', 'scale(' + mapView.zoom + ')');
        }

        function applyPanning() {
            $('#map-panning-group').attr('transform', 'translate(' + mapView.mapOriginX + ',' + mapView.mapOriginY + ')');
        }

        $(function() {

            //
            // zooming
            //

            (function() {


                $('#map-container').on('mousewheel', function(event) {
                    var amount = event.deltaY * event.deltaFactor;
                    var factor = Math.exp(amount / 1000);
                    mapView.zoom *= factor;
                    applyZoom();

                    var panningCorrectionFactor = (factor - 1) / mapView.zoom;
                    mapView.mapOriginX -= panningCorrectionFactor * event.pageX;
                    mapView.mapOriginY -= panningCorrectionFactor * event.pageY;
                    applyPanning();
                });

                applyZoom();

            })();


            //
            // panning
            //

            (function() {

                var dragging = false;
                var dragStartX, dragStartY;

                $('#map-container').on('mousemove', function(event) {
                    if (dragging) {
                        var zoomedPanningFactor = 1 / mapView.zoom;
                        mapView.mapOriginX += zoomedPanningFactor * (event.pageX - dragStartX);
                        mapView.mapOriginY += zoomedPanningFactor * (event.pageY - dragStartY);
                        applyPanning();
                        dragStartX = event.pageX;
                        dragStartY = event.pageY;
                    }
                });

                $('#map-container').on('mousedown', function(event) {
                    dragging = true;
                    dragStartX = event.pageX;
                    dragStartY = event.pageY;
                });

                $('#map-container').on('mouseup', function(event) {
                    dragging = false;
                });

                $('#map-container').on('contextmenu', function(event) {
                    var $element = $(document.createElementNS("http://www.w3.org/2000/svg", "circle"));
                    $element.attr('cx', event.pageX / mapView.zoom - mapView.mapOriginX);
                    $element.attr('cy', event.pageY / mapView.zoom - mapView.mapOriginY);
                    $element.attr('r', '40');
                    $element.attr('stroke', 'blue');
                    $element.attr('stroke-width', '3');
                    $element.attr('fill', 'red');
                    $('#map-panning-group').append($element);
                    return false;
                });

                applyPanning();

            })();

            for (i=0; i<10000; i++) {
                var $element = $(document.createElementNS("http://www.w3.org/2000/svg", "circle"));
                $element.attr('cx', Math.random() * 10000 - 5000);
                $element.attr('cy', Math.random() * 10000 - 5000);
                $element.attr('r', Math.random() * 50 + 10);
                $element.attr('stroke', 'blue');
                $element.attr('stroke-width', '3');
                $element.attr('fill', 'red');
                $('#map-panning-group').append($element);
            }

        });

    </script>
</head>
<body>
<div id="map-container">
    <svg id="map" width="100%" height="100%">
        <g id="map-zooming-group">
            <g id="map-panning-group">
                <circle cx="0" cy="0" r="40" stroke="blue" stroke-width="3" fill="red"/>
            </g>
        </g>
    </svg>
</div>
</body>
</html>