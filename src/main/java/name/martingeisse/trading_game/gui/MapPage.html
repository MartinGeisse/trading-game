<html>
<wicket:head>
    <style type="text/css">

        .map-container {
            position: fixed;
            top: 0px;
            left: 0px;
            right: 200px;
            bottom: 0px;
            background-color: black;
            color: white;
            cursor: move;
            overflow: hidden;
        }

        .map-surface {
            position: absolute;
        }

        .map {
            position: relative;
        }

        .map-object {
            position: absolute;
            top: 0px;
            left: 0px;
            font-weight: bold;
            cursor: default;
        }

        .map-object > .visual {
            position: absolute;
            display: inline-block;
            margin-top: -50%;
            margin-left: -40%;
            background-color: green;
        }

        .map-object > .name {
            display: inline-block;
            margin-top: 10px;
            margin-left: -50%;
        }

        .map-object > .objectIdentifier {
            display: none;
        }

        .right-sidebar {
            position: fixed;
            top: 0px;
            right: 0px;
            bottom: 0px;
            width: 200px;
        }

    </style>
    <script type="text/javascript">
        $(function() {

            var moveSpeed = 20, zoomFactor = 1.1;
            var translateX = 0, translateY = 0, scale = 1;
            var dragging = false, lastDragX = 0, lastDragY = 0;

            function update() {
                $('.map-surface').css('transform', 'scale(' + scale + ') translate(' + translateX + 'px, ' + translateY + 'px)');
            }

            function move(x, y) {
                translateX += x / scale;
                translateY += y / scale;
                update();
            }

            function zoom(viewX, viewY, factor) {
                scale *= factor;
                var k = (1 - factor) / scale;
                translateX += viewX * k;
                translateY += viewY * k;
                update();
            }

            function viewXToMapX(viewX) {
                return viewX / scale - translateX;
            }

            function viewYToMapY(viewY) {
                return viewY / scale - translateY;
            }

            function zoomOnMapCenter($mapContainer, zoomFactor) {
                zoom($mapContainer.width() / 2, $mapContainer.height() / 2, zoomFactor);
            }

            function round(x) {
                return Math.round(10 * x) / 10;
            }

            $('.map-container').on('keydown', function(e) {
                switch (e.key) {

                    case 'ArrowUp':
                        return move(0, moveSpeed);

                    case 'ArrowDown':
                        return move(0, -moveSpeed);

                    case 'ArrowLeft':
                        return move(+moveSpeed, 0);

                    case 'ArrowRight':
                        return move(-moveSpeed, 0);

                    case '+':
                        return zoomOnMapCenter($(this), zoomFactor);

                    case '-':
                        return zoomOnMapCenter($(this), 1 / zoomFactor);

                }
            });

            $('.map-container').on('mousedown', function (e) {
                dragging = true;
                lastDragX = e.clientX;
                lastDragY = e.clientY;
            });

            $('.map-container').on('mouseup mouseleave', function (e) {
                dragging = false;
            });

            $('.map-container').on('mouseenter', function (e) {
                if (e.buttons & 1) {
                    dragging = true;
                    lastDragX = e.clientX;
                    lastDragY = e.clientY;
                }
            });

            $('.map-container').on('mousemove', function(e) {
                if (dragging) {
                    move(e.clientX - lastDragX, e.clientY - lastDragY);
                    lastDragX = e.clientX;
                    lastDragY = e.clientY;
                }
            });

            $('.map-container').bind('mousewheel DOMMouseScroll', function(e) {
                if (e.originalEvent.wheelDelta > 0 || e.originalEvent.detail < 0) {
                    zoom(e.clientX, e.clientY, zoomFactor);
                } else {
                    zoom(e.clientX, e.clientY, 1 / zoomFactor);
                }
            });

            $('.map-container').on('click', '.map-object', function(e) {
                onSelectMapObject($('.objectIdentifier', this).text());
            });

        });
    </script>
</wicket:head>
<body>
    <div class="map-container" tabindex="0">
        <div class="map-surface">
            <div class="map" wicket:id="map">
                <div wicket:id="mapObjects" class="map-object">
                    <div class="visual" wicket:id="visual"></div>
                    <div class="objectIdentifier" wicket:id="objectIdentifier"></div>
                    <div class="name" wicket:id="name"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="right-sidebar" wicket:id="rightSidebar">
        <div wicket:id="test"></div>
    </div>
</body>
</html>
