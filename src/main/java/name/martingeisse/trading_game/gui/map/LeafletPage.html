<html>
<wicket:head>
    <script type="text/javascript">

        spaceObjectSelectionIndicator = null;
        leafletMap = null;

        $(function() {
            L.CRS.SimpleNonInverted = L.extend({}, L.CRS.Simple, {
                transformation: new L.Transformation(1, 0, 1, 0),
            });
            leafletMap = L.map('map', {
                crs: L.CRS.SimpleNonInverted,
                // maxZoom: 4
            }).setView([0, 0], 10);
            L.tileLayer(mapTileBaseUrl + '?x={x}&y={y}&z={z}', {
                continuousWorld: true,
                noWrap: true,
                // maxZoom: 3,
                bounds: L.latLngBounds(L.latLng(0, 0), L.latLng(256, 256)),
            }).addTo(leafletMap);
            leafletMap.on('click', function(e) {
                sendMapClickCommand(e.latlng.lat, e.latlng.lng, leafletMap.getZoom()); // TODO check lat/lng order
            });

            // SVG test
            L.d3SvgOverlay(function(selection, projection) {
                var originPoint = projection.latLngToLayerPoint(L.latLng(0, 0));
                var latLngUnitPoint = projection.latLngToLayerPoint(L.latLng(1, 1));
                var latLngUnit = latLngUnitPoint.x - originPoint.x;
                console.log(latLngUnit);
                var updateSelection = selection.selectAll('circle').data([1]);
                updateSelection.enter()
                    .append('circle')
                    .attr("cx", function(d) { return originPoint.x + 128 * latLngUnit; })
                    .attr("cy", function(d) { return originPoint.y + 128 * latLngUnit; })
                    .attr("r", function(d) { return 128 * latLngUnit; })
                    .attr("style", "stroke:#ff0000; fill: #0000ff");
            }).addTo(leafletMap);

        });

        changeSpaceObjectSelectionIndicator = function(lat, lng, radius) {
            if (spaceObjectSelectionIndicator != null) {
                spaceObjectSelectionIndicator.remove();
            }
            spaceObjectSelectionIndicator = L.circle(L.latLng(lat, lng), {radius: radius});
            spaceObjectSelectionIndicator.addTo(leafletMap);
            // console.log(lat + ", " + lng);
        };

    </script>
</wicket:head>
<body>
    <div id="map" style="position: fixed; top: 0px; bottom: 0px; left: 0px; right: 0px; cursor: initial; "></div>
</body>
</html>
